var APP3D;!function(){"use strict";function e(){function e(){window.speechSynthesis.resume()}function t(){window.speechSynthesis.pause()}function a(){b.volume=$(this).val()}function n(){$(this).scrollTop()===$("page").get(0).scrollHeight-$("page").height()&&i()}function o(a){function n(){function a(){if(b.onend=n,b.onresume=e,b.onpause=t,0===P.length){o=$(s).filter(":eq("+k+")"),$("page").scrollTop(o.offset().top-60-o.outerHeight()/2),$("page > *").css("background-color","transparent"),o.css("background-color","gray"),P=o.text().trim().split(".");for(var a=0;a<P.length;a++)P[a]=P[a];k++}var r=P.shift();if(r.length>250){r=r.split(",");for(var a=r.length-1;a>=0;a--)r[a]=r[a]+",",P.unshift(r[a])}else P.unshift(r);b.text=P.shift(),window.speechSynthesis.speak(b)}function n(){function e(){return y?!1:(clearInterval(C),s=$("page > p"),k===s.length?(Number($("#currentPage").val())<Number($("#maxPage").text())&&(i(),C=setInterval(e,250)),!1):void a())}return k===s.length?($("page").scrollTop($("page").get(0).scrollHeight-$("page").height()),C=setInterval(e,250),!1):void a()}var o,s=$("page > p");return 0===s.length?(Number($("#currentPage").val())<Number($("#maxPage").text())&&(i(),C=setInterval(check,250)),!1):void a()}a.preventDefault(),a.stopPropagation(),$(this).hasClass("play")?($(this).hasClass("paused")?(e(),$(this).removeClass("paused")):n(),$(this).removeClass("play").addClass("pause")):($(this).removeClass("pause").addClass("play"),t(),$(this).addClass("paused"))}function s(){var e=Number($(this).val()),t=Number($("#maxPage").text());e>t?(e=t,$(this).val(e)):0>=e&&(e=1,$(this).val(e)),e!==m&&(y=!0,m=e,$("page").empty(),k=0,window.speechSynthesis.cancel(),$(".read").removeClass("paused"),c($(".book :selected").val()))}function r(e){return(e.keyCode<96||e.keyCode>105||y)&&37!==e.keyCode&&39!==e.keyCode&&8!==e.keyCode&&46!==e.keyCode?(e.preventDefault(),e.stopPropagation(),!1):void 0}function i(){return m===Number($("#maxPage").text())||y?!1:(y=!0,m++,void c($(".book :selected").val()))}function p(){return 1===m||y?!1:(y=!0,$("page").empty(),window.speechSynthesis.cancel(),$(".read").removeClass("paused"),k=0,m--,void c($(".book :selected").val()))}function l(){function e(){function e(e){function a(){function e(e){b.lang=e.data.detections[0].language+"-"+e.data.detections[0].language.toUpperCase(),w=window.speechSynthesis.getVoices();for(var t=0;t<w.length;t++)if(w[t].lang===b.lang){b.voice=w[t];break}}$.post("php/getLang.php",{q:$("page").text()},e,"json")}m=e.page,c(t,a)}$.post("php/getCurrentPage.php",{name:t},e,"json")}var t=$(this).find(":selected").val();""!==t?(y=!0,k=0,$("page").empty(),window.speechSynthesis.cancel(),$(".read").removeClass("paused"),e(),$(".bookControl").removeClass("hide"),$(".readContainer").removeClass("hide")):($(".bookControl").addClass("hide"),$(".readContainer").addClass("hide"),$("page").html(""))}function c(e,t){function a(e){$("page").html($("page").html()+(""!==$("page").html()?"<hr>":"")+e.data),$("#currentPage").val(m),e.nbPage&&$("#maxPage").text(e.nbPage),y=!1,t&&t()}$.post("php/getPage.php",{page:m,name:e},a,"json")}function u(e){return e.preventDefault(),e.stopPropagation(),!1}function g(){$(".background").attr("src","img/"+$(this).val()+".jpg"),$("page").attr("style",$(".theme :selected").attr("pos"))}function d(e){v(e.target.files)}function h(e){e.preventDefault(),e.stopPropagation(),v(e.originalEvent.dataTransfer.files)}function f(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="copy"}function v(e){function t(t){function a(e){if(e.success){var t=$("<option></option>");t.text(e.name),t.val(e.name),$(".book").append(t)}else console.error(e.error)}$.post("php/upload.php",{data:t.target.result,name:e[0].name},a,"json")}var a=new FileReader;a.onload=t,a.readAsDataURL(e[0])}var m=1,y=!1;$("input[type=file]").bind("drop",h),$("input[type=file]").bind("dragover",f),$("input[type=file]").change(d),$(".theme").change(g),$(".book").change(l),$("page").mousedown(u),$(".next").mousedown(i),$(".prev").mousedown(p),$("#currentPage").keydown(r),$("#currentPage").keyup(s),$(".read").mousedown(o),$("page").scroll(n),$("#volumeSpeak").change(a),$(".theme").change();var C,w=window.speechSynthesis.getVoices(),b=new SpeechSynthesisUtterance;b.voice="none";var w,k=0,P=[]}$(document).ready(e)}();