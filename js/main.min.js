var APP3D;!function(){"use strict";function e(){function e(){window.speechSynthesis.resume()}function t(){window.speechSynthesis.pause()}function a(){b.volume=$(this).val()}function n(){$(this).scrollTop()===$("page").get(0).scrollHeight-$("page").height()&&p()}function o(a){function n(){function a(){b.onend=n,b.onresume=e,b.onpause=t;var a=$(o).filter(":eq("+k+")");$("page").scrollTop(a.offset().top),$("page > *").css("background-color","transparent"),a.css("background-color","gray"),b.text=a.text().trim()+" ",window.speechSynthesis.speak(b)}function n(){function e(){return y?!1:(clearInterval(C),o=$("page > *"),k===o.length?(Number($("#currentPage").val())<Number($("#maxPage").text())&&(p(),C=setInterval(e,250)),!1):void a())}return k++,k===o.length?($("page").scrollTop($("page").get(0).scrollHeight-$("page").height()),C=setInterval(e,250),!1):void a()}var o=$("page > *");return 0===o.length?(Number($("#currentPage").val())<Number($("#maxPage").text())&&(p(),C=setInterval(check,250)),!1):void a()}a.preventDefault(),a.stopPropagation(),$(this).hasClass("play")?($(this).hasClass("paused")?(e(),$(this).removeClass("paused")):n(),$(this).removeClass("play").addClass("pause")):($(this).removeClass("pause").addClass("play"),t(),$(this).addClass("paused"))}function s(){var e=Number($(this).val()),t=Number($("#maxPage").text());e>t?(e=t,$(this).val(e)):0>=e&&(e=1,$(this).val(e)),e!==m&&(y=!0,m=e,$("page").empty(),k=0,window.speechSynthesis.cancel(),$(".read").removeClass("paused"),u($(".book :selected").val()))}function r(e){return(e.keyCode<96||e.keyCode>105||y)&&37!==e.keyCode&&39!==e.keyCode&&8!==e.keyCode&&46!==e.keyCode?(e.preventDefault(),e.stopPropagation(),!1):void 0}function p(){return m===Number($("#maxPage").text())||y?!1:(y=!0,m++,void u($(".book :selected").val()))}function i(){return 1===m||y?!1:(y=!0,$("page").empty(),window.speechSynthesis.cancel(),$(".read").removeClass("paused"),k=0,m--,void u($(".book :selected").val()))}function l(){function e(){function e(e){function a(){function e(e){b.lang=e.data.detections[0].language+"-"+e.data.detections[0].language.toUpperCase()}$.post("php/getLang.php",{q:$("page").text()},e,"json")}m=e.page,u(t,a)}$.post("php/getCurrentPage.php",{name:t},e,"json")}var t=$(this).find(":selected").val();""!==t?(y=!0,k=0,$("page").empty(),window.speechSynthesis.cancel(),$(".read").removeClass("paused"),e(),$(".bookControl").removeClass("hide"),$(".readContainer").removeClass("hide")):($(".bookControl").addClass("hide"),$(".readContainer").addClass("hide"),$("page").html(""))}function u(e,t){function a(e){$("page").html($("page").html()+"<br />"+e.data),$("#currentPage").val(m),e.nbPage&&$("#maxPage").text(e.nbPage),y=!1,t&&t()}$.post("php/getPage.php",{page:m,name:e},a,"json")}function c(e){return e.preventDefault(),e.stopPropagation(),!1}function d(){$(".background").attr("src","img/"+$(this).val()+".jpg"),$("page").attr("style",$(".theme :selected").attr("pos"))}function g(e){f(e.target.files)}function h(e){e.preventDefault(),e.stopPropagation(),f(e.originalEvent.dataTransfer.files)}function v(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="copy"}function f(e){function t(t){function a(e){if(e.success){var t=$("<option></option>");t.text(e.name),t.val(e.name),$(".book").append(t)}else console.error(e.error)}$.post("php/upload.php",{data:t.target.result,name:e[0].name},a,"json")}var a=new FileReader;a.onload=t,a.readAsDataURL(e[0])}var m=1,y=!1;$("input[type=file]").bind("drop",h),$("input[type=file]").bind("dragover",v),$("input[type=file]").change(g),$(".theme").change(d),$(".book").change(l),$("page").mousedown(c),$(".next").mousedown(p),$(".prev").mousedown(i),$("#currentPage").keydown(r),$("#currentPage").keyup(s),$(".read").mousedown(o),$("page").scroll(n),$("#volumeSpeak").change(a);var C,b=new SpeechSynthesisUtterance,k=0}$(document).ready(e)}();