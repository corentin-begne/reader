var APP3D;!function(){"use strict";function e(e){function a(e){function a(){$(".book option:eq(0)").attr("selected",!0),n.remove(),$("page").empty(),z=!0}var t=Number($("page").css("fontSize").replace("px",""));switch(e.keyCode){case 109:t--;break;case 107:t++;break;case 46:var n=$(".book :selected");""!==n.val()&&z&&(z=!1,confirm("Supprimer l'Ebook "+n.val()+" ?")?$.post("php/delete.php",{name:n.val()},a):z=!0)}$("page").css("fontSize",t)}function t(){var e=$(this).find(":selected").val();return $(".sound").removeClass("pause").addClass("play"),N.pause(),""===e?!1:void(N.src=e)}function n(){return""===$(".soundContainer select :selected").val()?!1:void($(this).hasClass("play")?($(this).removeClass("play").addClass("pause"),N.play()):($(this).removeClass("pause").addClass("play"),N.pause()))}function o(){N.volume=$(this).val()}function s(){window.speechSynthesis.resume()}function r(){window.speechSynthesis.pause()}function i(){D.volume=$(this).val()}function p(){$(this).scrollTop()===$("page").get(0).scrollHeight-$("page").height()&&d()}function l(e){function a(){function e(){function e(e,a){if(-1!==i.indexOf(a)&&i.indexOf(a)!=i.length-1){for(var t=i.split(a),n=t.length-1;n>=0;n--)t[n]=t[n]+a,j.unshift(t[n]);return!1}}if(D.onend=a,D.onresume=s,D.onpause=r,0===j.length){t=$("page > p").filter(":eq("+T+")");var n=t.text().trim();if(""!==n){$("page").scrollTop(t.position().top+$("page").scrollTop()),$("page > *").css("background-color","transparent"),t.css("background-color","gray"),j=n.split(".");for(var o=0;o<j.length;o++)""!==j[o]?j[o]=j[o]:j.splice(o,1)}T++}var i=j.shift();return void 0===i?void a():(i.length>250?$.each([",",";","?","!","â€“","-"],e):j.unshift(i),D.text=j.shift(),void window.speechSynthesis.speak(D))}function a(){function a(){return P?!1:(clearInterval(x),n=$("page > p"),T===n.length?(Number($("#currentPage").val())<Number($("#maxPage").text())&&(d(),x=setInterval(a,250)),!1):void e())}return T===n.length?($("page").scrollTop($("page").get(0).scrollHeight-$("page").height()),x=setInterval(a,250),!1):void e()}var t,n=$("page > p");return 0===n.length?(Number($("#currentPage").val())<Number($("#maxPage").text())&&(d(),x=setInterval(check,250)),!1):void e()}e.preventDefault(),e.stopPropagation(),$(this).hasClass("play")?($(this).hasClass("paused")?(s(),$(this).removeClass("paused")):a(),$(this).removeClass("play").addClass("pause")):($(this).removeClass("pause").addClass("play"),r(),$(this).addClass("paused"))}function c(){var e=Number($(this).val()),a=Number($("#maxPage").text());e>a?(e=a,$(this).val(e)):0>=e&&(e=1,$(this).val(e)),e!==b&&(P=!0,b=e,$("page").empty(),T=0,window.speechSynthesis.cancel(),$(".read").removeClass("paused"),v($(".book :selected").val()))}function u(e){return(e.keyCode<96||e.keyCode>105||P)&&37!==e.keyCode&&39!==e.keyCode&&8!==e.keyCode&&46!==e.keyCode?(e.preventDefault(),e.stopPropagation(),!1):void 0}function d(){return b===Number($("#maxPage").text())||P?!1:(P=!0,b++,void v($(".book :selected").val()))}function h(){return 1===b||P?!1:(P=!0,$("page").empty(),window.speechSynthesis.cancel(),$(".read").removeClass("paused"),T=0,b--,void v($(".book :selected").val()))}function g(){function e(){function e(e){function t(){function e(e){D.lang=e.data.detections[0].language+"-"+e.data.detections[0].language.toUpperCase(),S=window.speechSynthesis.getVoices();for(var a=0;a<S.length;a++)if(S[a].lang===D.lang){D.voice=S[a];break}}$.post("php/getLang.php",{q:$("page").text()},e,"json")}b=e.page,v(a,t)}$.post("php/getCurrentPage.php",{name:a},e,"json")}var a=$(this).find(":selected").val();""!==a?(P=!0,T=0,$("page").empty(),window.speechSynthesis.cancel(),$(".read").removeClass("paused"),e(),$(".bookControl").removeClass("hide"),$(".readContainer").removeClass("hide")):($(".bookControl").addClass("hide"),$(".readContainer").addClass("hide"),$("page").html(""))}function v(e,a){function t(e){$("page").html($("page").html()+((""!==$("page").html()?"<hr>":"")+e.data)),$("#currentPage").val(b),e.nbPage&&$("#maxPage").text(e.nbPage),P=!1,a&&a()}$.post("php/getPage.php",{page:b,name:e},t,"json")}function f(e){return e.preventDefault(),e.stopPropagation(),!1}function m(){var e="white"===$(this).val()||"black"===$(this).val()?"":"img/"+$(this).val()+".jpg";$(".background").attr("src",e),$("page").attr("style",$(".theme :selected").attr("pos")+"font-size:"+$("page").css("fontSize")+";")}function y(e){w(e.target.files)}function C(e){e.preventDefault(),e.stopPropagation(),w(e.originalEvent.dataTransfer.files)}function k(e){e.preventDefault(),e.stopPropagation(),e.originalEvent.dataTransfer.dropEffect="copy"}function w(e){function a(a){function t(e){if(e.success){var a=$("<option></option>");a.text(e.name),a.val(e.name),$(".book").append(a)}else console.error(e.error)}$.post("php/upload.php",{data:a.target.result,name:e[0].name},t,"json")}var t=new FileReader;t.onload=a,t.readAsDataURL(e[0])}var b=1,P=!1;$("input[type=file]").bind("drop",C),$("input[type=file]").bind("dragover",k),$("input[type=file]").change(y),$(".theme").change(m),$(".book").change(g),$("page").mousedown(f),$(".next").mousedown(d),$(".prev").mousedown(h),$("#currentPage").keydown(u),$("#currentPage").keyup(c),$(".read").mousedown(l),$("page").scroll(p),$("#volumeSpeak").change(i),$(".theme").change(),$(".soundContainer select").change(t),$("#volumeSound").change(o),$(".sound").mousedown(n),$(document).keydown(a);var x,S,N=new Audio,S=window.speechSynthesis.getVoices(),D=new SpeechSynthesisUtterance,T=0,j=[],z=!0;-1===window.location.href.indexOf("noCursor")}$(document).ready(e)}();